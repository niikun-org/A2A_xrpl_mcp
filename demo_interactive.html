<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A2A Trace Anchoring - ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ‡ãƒ¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .demo-flow {
            display: grid;
            gap: 20px;
        }

        .step-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            opacity: 0.3;
            transform: scale(0.95);
            transition: all 0.5s ease;
        }

        .step-card.active {
            opacity: 1;
            transform: scale(1);
            border: 3px solid #667eea;
        }

        .step-card.completed {
            opacity: 0.7;
            background: #f0fff4;
            border: 2px solid #48bb78;
        }

        .step-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .step-number {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
        }

        .step-card.completed .step-number {
            background: #48bb78;
        }

        .step-title {
            font-size: 1.5em;
            color: #2d3748;
        }

        .step-content {
            margin-left: 65px;
        }

        .step-description {
            color: #4a5568;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .code-block {
            background: #2d3748;
            color: #68d391;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .data-box {
            background: #edf2f7;
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e2e8f0;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.5s ease;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            position: sticky;
            top: 20px;
            z-index: 100;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .btn {
            padding: 15px 40px;
            font-size: 1.1em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.6);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #2d3748;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .arrow-down {
            text-align: center;
            color: white;
            font-size: 2em;
            margin: 10px 0;
            opacity: 0;
            animation: fadeInDown 0.5s ease forwards;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .highlight {
            background: #fef5e7;
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: bold;
            color: #d35400;
        }

        .checkmark {
            color: #48bb78;
            font-size: 1.2em;
            margin-right: 5px;
        }

        .animation-box {
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            color: #4a5568;
        }

        .pulse {
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .stat-label {
            color: #718096;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #2d3748;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” A2A Trace Anchoring on XRPL</h1>
            <p>ğŸ†• MCPçµ±åˆï¼AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å®Ÿè¡Œè¨˜éŒ²ã‚’æ”¹ã–ã‚“ä¸å¯èƒ½ã«ã™ã‚‹ä»•çµ„ã¿</p>
            <p style="font-size: 0.9em; margin-top: 10px;">Model Context Protocol (MCP) â†’ IPFS â†’ XRPL Blockchain</p>
        </div>

        <div class="controls">
            <button class="btn btn-secondary" id="resetBtn">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
            <button class="btn btn-primary" id="nextBtn">â–¶ï¸ æ¬¡ã¸</button>
            <button class="btn btn-primary" id="autoBtn">âš¡ è‡ªå‹•å†ç”Ÿ</button>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>

        <div class="demo-flow" id="demoFlow">
            <!-- Steps will be dynamically added here -->
        </div>
    </div>

    <script>
        const steps = [
            {
                title: "ğŸ†• MCPã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ‡ãƒ¢",
                description: "GradioUIã§AIã¨ãƒãƒ£ãƒƒãƒˆ - ã™ã¹ã¦ã®ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã‚’è¨˜éŒ²",
                content: `
<div class="animation-box" id="step0-anim">
    <span class="pulse">ğŸ’¬ Gradio UIã§AIã¨å¯¾è©±ä¸­...</span>
</div>
<div class="data-box">
    <strong>ğŸ”§ MCP (Model Context Protocol):</strong><br>
    ãƒ»AIãŒ5ã¤ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨å¯èƒ½<br>
    ãƒ»è¨ˆç®—æ©Ÿã€æ™‚è¨ˆã€æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆã€æ–‡å­—åˆ—åè»¢ã€å›æ–‡ãƒã‚§ãƒƒã‚¯<br>
    ãƒ»ã™ã¹ã¦ã®ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ãŒJSON-RPCã§è¨˜éŒ²ã•ã‚Œã‚‹
</div>
<div class="code-block">ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã€Œ25 * 4ã¯ã„ãã¤ï¼Ÿã€
â†“
AI â†’ MCP Client â†’ MCP Server
â†“
Tool: calculate(expression="25 * 4")
â†“
çµæœ: 100
â†“
Logger: ã™ã¹ã¦JSON-RPCã§è¨˜éŒ²
logs/events.jsonl ã«ä¿å­˜</div>
<div class="stats">
    <div class="stat-card">
        <div class="stat-label">ãƒ„ãƒ¼ãƒ«æ•°</div>
        <div class="stat-value">5</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">è¨˜éŒ²å½¢å¼</div>
        <div class="stat-value">JSON-RPC</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ </div>
        <div class="stat-value">âœ“</div>
    </div>
</div>
                `
            },
            {
                title: "AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œï¼ˆå¾“æ¥å‹ï¼‰",
                description: "LangChainã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ä¾‹ - Haikuç”Ÿæˆ",
                content: `
<div class="animation-box" id="step1-anim">
    <span class="pulse">ğŸ¤– AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå‹•ä½œä¸­...</span>
</div>
<div class="data-box">
    <strong>å…¥åŠ›:</strong> "please write a poem."<br>
    <strong>å‡ºåŠ›:</strong> Haiku (5-7-5å½¢å¼ã®è©©)<br>
    <strong>ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—:</strong> check_haiku_lines()
</div>
<div class="code-block">ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã€Œè©©ã‚’æ›¸ã„ã¦ãã ã•ã„ã€
â†“
AI: ãƒ„ãƒ¼ãƒ«ã€Œcheck_haiku_linesã€ã‚’å‘¼ã³å‡ºã—
â†“
AI: Haikuã‚’ç”Ÿæˆ
â†“
çµæœ: "Field lights bite the dusk
      Fans roar, drums call through the stands
      Glory tastes of rain"</div>
                `
            },
            {
                title: "A2Aæ¨™æº–å½¢å¼ã«å¤‰æ›",
                description: "å®Ÿè¡Œãƒ­ã‚°ã‚’å›½éš›æ¨™æº–ã®A2Aå½¢å¼ï¼ˆJSONï¼‰ã«å¤‰æ›",
                content: `
<div class="animation-box" id="step2-anim">
    <span class="pulse">ğŸ“‹ å¤‰æ›å‡¦ç†ä¸­...</span>
</div>
<div class="stats">
    <div class="stat-card">
        <div class="stat-label">ã‚»ãƒƒã‚·ãƒ§ãƒ³ID</div>
        <div class="stat-value">abc123</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">ã‚¤ãƒ™ãƒ³ãƒˆæ•°</div>
        <div class="stat-value">20</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">ãƒˆãƒ¼ã‚¯ãƒ³æ•°</div>
        <div class="stat-value">1,562</div>
    </div>
</div>
<div class="code-block">{
  "traceVersion": "a2a-0.1",
  "session": {
    "id": "session-abc123",
    "actors": ["user", "assistant", "tool"]
  },
  "events": [
    {"type": "human_message", "content": "..."},
    {"type": "ai_tool_call", "tool": "check_haiku_lines"},
    {"type": "ai_message", "content": "..."}
  ]
}</div>
                `
            },
            {
                title: "Merkle Rootè¨ˆç®—",
                description: "ãƒ‡ãƒ¼ã‚¿ã®ã€ŒæŒ‡ç´‹ã€ã‚’ä½œæˆï¼ˆæ”¹ã–ã‚“æ¤œçŸ¥ç”¨ï¼‰",
                content: `
<div class="animation-box" id="step3-anim">
    <span class="pulse">ğŸ” ãƒãƒƒã‚·ãƒ¥è¨ˆç®—ä¸­...</span>
</div>
<div class="data-box">
    <strong>ğŸ”§ å‡¦ç†:</strong><br>
    1ï¸âƒ£ JSONã‚’4096ãƒã‚¤ãƒˆã®ãƒãƒ£ãƒ³ã‚¯ã«åˆ†å‰²<br>
    2ï¸âƒ£ å„ãƒãƒ£ãƒ³ã‚¯ã‚’SHA256ã§ãƒãƒƒã‚·ãƒ¥åŒ–<br>
    3ï¸âƒ£ ãƒãƒƒã‚·ãƒ¥ãƒ„ãƒªãƒ¼ã‚’æ§‹ç¯‰<br>
    4ï¸âƒ£ Merkle Rootã‚’å–å¾—
</div>
<div class="code-block">Chunk 1: {...éƒ¨åˆ†1...} â†’ hash1: a3f5b8c...
Chunk 2: {...éƒ¨åˆ†2...} â†’ hash2: d9e2f1a...
â†“
Merkle Root: <span class="highlight">43b10e78082bfd87...</span></div>
<div class="data-box">
    ğŸ’¡ <strong>ãƒã‚¤ãƒ³ãƒˆ:</strong> 1æ–‡å­—ã§ã‚‚å¤‰æ›´ã•ã‚Œã‚‹ã¨ã€å…¨ãé•ã†å€¤ã«ãªã‚‹ï¼
</div>
                `
            },
            {
                title: "IPFSä¿å­˜",
                description: "åˆ†æ•£ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆIPFSï¼‰ã«æ°¸ä¹…ä¿å­˜",
                content: `
<div class="animation-box" id="step4-anim">
    <span class="pulse">ğŸŒ IPFSã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...</span>
</div>
<div class="data-box">
    <strong>IPFS = InterPlanetary File System</strong><br>
    ãƒ»ä¸­å¤®ã‚µãƒ¼ãƒãƒ¼ãªã—ï¼ˆåˆ†æ•£å‹ï¼‰<br>
    ãƒ»ä¸–ç•Œä¸­ã®ãƒãƒ¼ãƒ‰ã«ä¿å­˜<br>
    ãƒ»CIDï¼ˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„IDï¼‰ã§ç‰¹å®š
</div>
<div class="code-block">trace.json â†’ IPFS Network
â†“
CIDå–å¾—: <span class="highlight">bafybeigdyrzt5sfp7udm7hu76uh7y26nf...</span>
â†“
âœ… ä¸–ç•Œä¸­ã®ã©ã®IPFSãƒãƒ¼ãƒ‰ã‹ã‚‰ã§ã‚‚å–å¾—å¯èƒ½ï¼</div>
<div class="stats">
    <div class="stat-card">
        <div class="stat-label">ä¿å­˜å…ˆ</div>
        <div class="stat-value">åˆ†æ•£</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">ã‚³ã‚¹ãƒˆ</div>
        <div class="stat-value">ç„¡æ–™</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">æ°¸ç¶šæ€§</div>
        <div class="stat-value">é«˜</div>
    </div>
</div>
                `
            },
            {
                title: "XRPLè¨˜éŒ²",
                description: "ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ï¼ˆXRP Ledgerï¼‰ã«è¨˜éŒ²",
                content: `
<div class="animation-box" id="step5-anim">
    <span class="pulse">ğŸ“˜ ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã«è¨˜éŒ²ä¸­...</span>
</div>
<div class="data-box">
    <strong>XRP Ledger = è¶…é«˜é€Ÿãƒ»ä½ã‚³ã‚¹ãƒˆãªãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³</strong><br>
    ãƒ»ç¢ºå®šæ™‚é–“: <span class="highlight">3-5ç§’</span><br>
    ãƒ»æ‰‹æ•°æ–™: <span class="highlight">ç´„0.0001å††</span><br>
    ãƒ»å…¬é–‹å°å¸³: èª°ã§ã‚‚é–²è¦§å¯èƒ½
</div>
<div class="code-block">ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ä½œæˆ:
  é‡‘é¡: 1 drop (0.000001 XRP)
  Memo: {
    "cid": "bafybeigdyrzt5...",
    "root": "43b10e78082bfd...",
    "timestamp": 1730544060
  }
â†“
TX Hash: <span class="highlight">1A2B3C4D5E6F...</span>
â†“
âœ… ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã«æ°¸ä¹…è¨˜éŒ²ï¼</div>
<div class="stats">
    <div class="stat-card">
        <div class="stat-label">ç¢ºå®šæ™‚é–“</div>
        <div class="stat-value">3-5ç§’</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">æ‰‹æ•°æ–™</div>
        <div class="stat-value">0.0001å††</div>
    </div>
</div>
                `
            },
            {
                title: "æ¤œè¨¼ ğŸ†• Gradio UIã§å¯èƒ½ï¼",
                description: "èª°ã§ã‚‚æ”¹ã–ã‚“ã‚’ãƒã‚§ãƒƒã‚¯ã§ãã‚‹ - UIã‹ã‚‰ç°¡å˜ã«æ¤œè¨¼",
                content: `
<div class="animation-box" id="step6-anim">
    <span class="pulse">ğŸ” æ¤œè¨¼ä¸­...</span>
</div>
<div class="data-box" style="background: #e6f7ff; border-left-color: #1890ff;">
    <strong>ğŸ†• Gradio UIã§æ¤œè¨¼:</strong><br>
    ãƒ»ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒƒã‚·ãƒ¥ã‚’å…¥åŠ›<br>
    ãƒ»"ğŸ” Verify Trace"ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯<br>
    ãƒ»è‡ªå‹•çš„ã«æ¤œè¨¼ãƒ—ãƒ­ã‚»ã‚¹ã‚’å®Ÿè¡Œ<br>
    ãƒ»çµæœã‚’è¦–è¦šçš„ã«è¡¨ç¤ºï¼
</div>
<div class="data-box">
    <strong>ğŸ” æ¤œè¨¼ãƒ•ãƒ­ãƒ¼:</strong><br>
    1ï¸âƒ£ XRPLã‹ã‚‰ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å–å¾—<br>
    2ï¸âƒ£ Memoã‹ã‚‰CIDã¨Merkle RootæŠ½å‡º<br>
    3ï¸âƒ£ IPFSã‹ã‚‰CIDã§ãƒˆãƒ¬ãƒ¼ã‚¹å–å¾—<br>
    4ï¸âƒ£ Merkle Rootå†è¨ˆç®—<br>
    5ï¸âƒ£ æ¯”è¼ƒ â†’ ä¸€è‡´ã™ã‚Œã°æ”¹ã–ã‚“ãªã—ï¼
</div>
<div class="code-block">TX Hash â†’ XRPL â†’ Memoå–å¾—
â†“
CID: bafybeigdyrzt5...
Merkle Root: 43b10e78082bfd...
â†“
IPFS â†’ Traceå–å¾— â†’ Merkle Rootå†è¨ˆç®—
â†“
ä¿å­˜Root == è¨ˆç®—Root ?
â†“
<span class="highlight" style="color: #48bb78;">âœ“ ä¸€è‡´ â†’ æ”¹ã–ã‚“ãªã—ï¼</span></div>
<div class="data-box" style="border-left-color: #48bb78; background: #f0fff4;">
    <span class="checkmark">âœ“</span> <strong>æ¤œè¨¼æˆåŠŸï¼</strong><br>
    ã“ã®ãƒˆãƒ¬ãƒ¼ã‚¹ã¯æ”¹ã–ã‚“ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚<br>
    2025/11/03 12:00:00 ã«è¨˜éŒ²ã•ã‚Œã¾ã—ãŸã€‚
</div>
                `
            }
        ];

        let currentStep = -1;
        let autoPlayInterval = null;

        function initDemo() {
            const demoFlow = document.getElementById('demoFlow');
            steps.forEach((step, index) => {
                const stepCard = document.createElement('div');
                stepCard.className = 'step-card';
                stepCard.id = `step-${index}`;
                stepCard.innerHTML = `
                    <div class="step-header">
                        <div class="step-number">${index + 1}</div>
                        <div class="step-title">${step.title}</div>
                    </div>
                    <div class="step-content">
                        <div class="step-description">${step.description}</div>
                        ${step.content}
                    </div>
                `;
                demoFlow.appendChild(stepCard);

                if (index < steps.length - 1) {
                    const arrow = document.createElement('div');
                    arrow.className = 'arrow-down';
                    arrow.id = `arrow-${index}`;
                    arrow.innerHTML = 'â†“';
                    arrow.style.display = 'none';
                    demoFlow.appendChild(arrow);
                }
            });
        }

        function nextStep() {
            if (currentStep >= 0) {
                document.getElementById(`step-${currentStep}`).classList.remove('active');
                document.getElementById(`step-${currentStep}`).classList.add('completed');
            }

            currentStep++;

            if (currentStep >= steps.length) {
                currentStep = steps.length - 1;
                stopAutoPlay();
                return;
            }

            const stepCard = document.getElementById(`step-${currentStep}`);
            stepCard.classList.add('active');
            stepCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

            if (currentStep > 0) {
                const arrow = document.getElementById(`arrow-${currentStep - 1}`);
                arrow.style.display = 'block';
            }

            updateProgress();
        }

        function updateProgress() {
            const progress = ((currentStep + 1) / steps.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function reset() {
            currentStep = -1;
            document.querySelectorAll('.step-card').forEach(card => {
                card.classList.remove('active', 'completed');
            });
            document.querySelectorAll('.arrow-down').forEach(arrow => {
                arrow.style.display = 'none';
            });
            updateProgress();
            stopAutoPlay();
        }

        function startAutoPlay() {
            if (autoPlayInterval) return;

            const autoBtn = document.getElementById('autoBtn');
            autoBtn.textContent = 'â¸ï¸ åœæ­¢';

            autoPlayInterval = setInterval(() => {
                if (currentStep >= steps.length - 1) {
                    stopAutoPlay();
                } else {
                    nextStep();
                }
            }, 6000); // 3ç§’ã‹ã‚‰6ç§’ã«å¤‰æ›´
        }

        function stopAutoPlay() {
            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
                autoPlayInterval = null;
                const autoBtn = document.getElementById('autoBtn');
                autoBtn.textContent = 'âš¡ è‡ªå‹•å†ç”Ÿ';
            }
        }

        function toggleAutoPlay() {
            if (autoPlayInterval) {
                stopAutoPlay();
            } else {
                if (currentStep >= steps.length - 1) {
                    reset();
                }
                startAutoPlay();
            }
        }

        // Event listeners
        document.getElementById('nextBtn').addEventListener('click', () => {
            stopAutoPlay();
            nextStep();
        });

        document.getElementById('resetBtn').addEventListener('click', reset);
        document.getElementById('autoBtn').addEventListener('click', toggleAutoPlay);

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                stopAutoPlay();
                nextStep();
            } else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                stopAutoPlay();
                if (currentStep > 0) {
                    currentStep--;
                    reset();
                    for (let i = 0; i <= currentStep; i++) {
                        nextStep();
                    }
                }
            } else if (e.key === 'r' || e.key === 'R') {
                reset();
            } else if (e.key === 'a' || e.key === 'A') {
                toggleAutoPlay();
            }
        });

        // Initialize
        initDemo();
    </script>
</body>
</html>
